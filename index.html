<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جعبه ابزار پیشرفته</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-light: #6b7280;
            --border-radius: 16px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Vazir', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 15px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        header {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }

        header h1 { margin: 0; font-size: 1.6rem; }
        header p { margin-top: 8px; opacity: 0.9; font-size: 0.9rem; }

        /* Scrollable Tabs */
        .tabs-container {
            background: #e0e7ff;
            padding: 5px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .tabs {
            display: flex;
            gap: 5px;
            padding-bottom: 5px;
            min-width: max-content; /* Ensures tabs don't squish */
        }

        .tab-btn {
            padding: 12px 18px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-family: 'Vazir', sans-serif;
            font-size: 0.9rem;
            color: var(--text-main);
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .tab-btn:hover { background: rgba(255,255,255,0.5); }
        .tab-btn.active {
            background: white;
            color: var(--primary);
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .content { padding: 25px; min-height: 400px; }
        .tool-section { display: none; animation: fadeIn 0.4s ease; }
        .tool-section.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-weight: 500; font-size: 0.9rem; }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-family: 'Vazir', sans-serif;
            font-size: 1rem;
            box-sizing: border-box;
        }
        input:focus, select:focus { outline: none; border-color: var(--primary); }

        button.action-btn {
            width: 100%;
            padding: 14px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            font-family: 'Vazir', sans-serif;
            font-weight: bold;
            margin-top: 10px;
        }
        button.action-btn.secondary { background-color: #10b981; margin-top: 5px; }

        .result-box {
            margin-top: 25px;
            padding: 20px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            display: none;
            text-align: center;
        }
        .result-value { font-size: 1.4rem; font-weight: bold; color: var(--primary); margin: 10px 0; }
        .result-detail { color: var(--text-light); line-height: 1.8; font-size: 0.95rem; text-align: right; }

        .row { display: flex; gap: 15px; }
        .col { flex: 1; }
        @media (max-width: 600px) { .row { flex-direction: column; gap: 10px; } }
        
        /* Specific for Password */
        .password-display {
            background: #374151;
            color: #fff;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 1.2rem;
            word-break: break-all;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1><i class="fas fa-shapes"></i> جعبه ابزار همه‌کاره</h1>
        <p>۱۰ ابزار کاربردی و دقیق در جیب شما</p>
    </header>

    <!-- Scrollable Tabs -->
    <div class="tabs-container">
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('gold')"><i class="fas fa-coins"></i> قیمت طلا</button>
            <button class="tab-btn" onclick="openTab('discount')"><i class="fas fa-tags"></i> تخفیف</button>
            <button class="tab-btn" onclick="openTab('pass')"><i class="fas fa-key"></i> پسورد</button>
            <button class="tab-btn" onclick="openTab('bmi')"><i class="fas fa-weight"></i> BMI</button>
            <button class="tab-btn" onclick="openTab('calories')"><i class="fas fa-fire"></i> کالری</button>
            <button class="tab-btn" onclick="openTab('age')"><i class="fas fa-birthday-cake"></i> سن</button>
            <button class="tab-btn" onclick="openTab('date')"><i class="fas fa-calendar-alt"></i> تاریخ</button>
            <button class="tab-btn" onclick="openTab('loan')"><i class="fas fa-money-bill-wave"></i> وام</button>
            <button class="tab-btn" onclick="openTab('unit')"><i class="fas fa-ruler-combined"></i> واحد</button>
            <button class="tab-btn" onclick="openTab('baby')"><i class="fas fa-baby"></i> نوزاد</button>
        </div>
    </div>

    <div class="content">

        <!-- 1. Gold Calculator (NEW) -->
        <div id="gold" class="tool-section active">
            <h2><i class="fas fa-calculator"></i> محاسبه قیمت طلا</h2>
            <p class="text-light">محاسبه دقیق قیمت خرید طلا با اجرت و سود قانونی</p>
            <div class="row">
                <div class="col">
                    <label>قیمت روز یک گرم طلای ۱۸ (تومان)</label>
                    <input type="number" id="gold-price" placeholder="مثلا 3500000">
                </div>
                <div class="col">
                    <label>وزن طلا (گرم)</label>
                    <input type="number" id="gold-weight" placeholder="مثلا 5.2">
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <label>اجرت ساخت (درصد)</label>
                    <input type="number" id="gold-wage" placeholder="معمولا بین 10 تا 25">
                </div>
                <div class="col">
                    <label>سود فروشنده (درصد)</label>
                    <input type="number" id="gold-profit" value="7" readonly style="background:#eee">
                </div>
            </div>
            <button class="action-btn" onclick="calcGold()">محاسبه قیمت نهایی</button>
            <div id="gold-result" class="result-box"></div>
        </div>

        <!-- 2. Discount Calculator (NEW) -->
        <div id="discount" class="tool-section">
            <h2><i class="fas fa-percent"></i> محاسبه تخفیف</h2>
            <div class="row">
                <div class="col">
                    <label>قیمت اصلی (تومان)</label>
                    <input type="number" id="disc-price" placeholder="مثلا 500000">
                </div>
                <div class="col">
                    <label>درصد تخفیف</label>
                    <input type="number" id="disc-percent" placeholder="مثلا 30">
                </div>
            </div>
            <button class="action-btn" onclick="calcDiscount()">محاسبه</button>
            <div id="disc-result" class="result-box"></div>
        </div>

        <!-- 3. Password Generator (NEW) -->
        <div id="pass" class="tool-section">
            <h2><i class="fas fa-lock"></i> ساخت رمز عبور قوی</h2>
            <div class="row">
                <div class="col">
                    <label>طول رمز عبور</label>
                    <select id="pass-len">
                        <option value="8">8 کاراکتر (معمولی)</option>
                        <option value="12" selected>12 کاراکتر (قوی)</option>
                        <option value="16">16 کاراکتر (خیلی قوی)</option>
                    </select>
                </div>
                <div class="col">
                    <label style="margin-top:30px">
                        <input type="checkbox" id="pass-symbol" checked style="width:auto"> شامل !@#$%
                    </label>
                </div>
            </div>
            <button class="action-btn" onclick="genPass()">تولید رمز جدید</button>
            <div id="pass-result" class="result-box" style="display:block; margin-top:10px">
                <div id="pass-text" class="password-display">روی دکمه بالا بزنید</div>
                <button class="action-btn secondary" onclick="copyPass()" style="padding:8px; font-size:0.9rem">کپی کردن</button>
            </div>
        </div>

        <!-- 4. Calories BMR (NEW) -->
        <div id="calories" class="tool-section">
            <h2><i class="fas fa-apple-alt"></i> محاسبه کالری مورد نیاز</h2>
            <div class="row">
                <div class="col">
                    <label>جنسیت</label>
                    <select id="cal-gender">
                        <option value="m">مرد</option>
                        <option value="f">زن</option>
                    </select>
                </div>
                <div class="col">
                    <label>سن</label>
                    <input type="number" id="cal-age">
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <label>قد (سانتی‌متر)</label>
                    <input type="number" id="cal-height">
                </div>
                <div class="col">
                    <label>وزن (کیلوگرم)</label>
                    <input type="number" id="cal-weight">
                </div>
            </div>
            <label>میزان فعالیت</label>
            <select id="cal-activity">
                <option value="1.2">کم تحرک (پشت میز نشین)</option>
                <option value="1.375">کمی فعال (ورزش ۱-۳ روز)</option>
                <option value="1.55">متوسط (ورزش ۳-۵ روز)</option>
                <option value="1.725">خیلی فعال (ورزش هر روز)</option>
            </select>
            <button class="action-btn" onclick="calcCalories()">محاسبه کالری</button>
            <div id="cal-result" class="result-box"></div>
        </div>

        <!-- 5. BMI -->
        <div id="bmi" class="tool-section">
            <h2>محاسبه شاخص توده بدنی</h2>
            <div class="row">
                <div class="col"><label>وزن (kg)</label><input type="number" id="bmi-weight"></div>
                <div class="col"><label>قد (cm)</label><input type="number" id="bmi-height"></div>
            </div>
            <button class="action-btn" onclick="calculateBMI()">محاسبه</button>
            <div id="bmi-result" class="result-box"></div>
        </div>

        <!-- 6. Exact Age -->
        <div id="age" class="tool-section">
            <h2>محاسبه دقیق سن</h2>
            <div class="row">
                <div class="col"><input type="number" id="age-day" placeholder="روز"></div>
                <div class="col">
                    <select id="age-month">
                        <option value="1">فروردین</option><option value="2">اردیبهشت</option><option value="3">خرداد</option>
                        <option value="4">تیر</option><option value="5">مرداد</option><option value="6">شهریور</option>
                        <option value="7">مهر</option><option value="8">آبان</option><option value="9">آذر</option>
                        <option value="10">دی</option><option value="11">بهمن</option><option value="12">اسفند</option>
                    </select>
                </div>
                <div class="col"><input type="number" id="age-year" placeholder="سال"></div>
            </div>
            <button class="action-btn" onclick="calculateAge()">محاسبه</button>
            <div id="age-result" class="result-box"></div>
        </div>

        <!-- 7. Date Converter -->
        <div id="date" class="tool-section">
            <h2>تبدیل تاریخ</h2>
            <select id="date-type" onchange="toggleDateInputs()"><option value="s2g">شمسی به میلادی</option><option value="g2s">میلادی به شمسی</option></select>
            <div class="row" style="margin-top:10px">
                <div class="col"><input type="number" id="d-day" placeholder="روز"></div>
                <div class="col"><input type="number" id="d-month" placeholder="ماه"></div>
                <div class="col"><input type="number" id="d-year" placeholder="سال"></div>
            </div>
            <button class="action-btn" onclick="convertDate()">تبدیل</button>
            <div id="date-result" class="result-box"></div>
        </div>

        <!-- 8. Loan -->
        <div id="loan" class="tool-section">
            <h2>محاسبه اقساط وام</h2>
            <div class="row">
                <div class="col"><label>مبلغ (تومان)</label><input type="number" id="loan-amount"></div>
                <div class="col"><label>درصد سود</label><input type="number" id="loan-rate"></div>
            </div>
            <label>تعداد اقساط (ماه)</label><input type="number" id="loan-months">
            <button class="action-btn" onclick="calculateLoan()">محاسبه</button>
            <div id="loan-result" class="result-box"></div>
        </div>

        <!-- 9. Unit Converter -->
        <div id="unit" class="tool-section">
            <h2>تبدیل واحد</h2>
            <select id="unit-category" onchange="updateUnitOptions()"><option value="length">طول</option><option value="weight">وزن</option><option value="temp">دما</option></select>
            <div class="row" style="margin-top:10px">
                <div class="col"><input type="number" id="unit-value" placeholder="مقدار"></div>
                <div class="col"><select id="unit-from"></select></div>
                <div class="col"><select id="unit-to"></select></div>
            </div>
            <button class="action-btn" onclick="convertUnit()">محاسبه</button>
            <div id="unit-result" class="result-box"></div>
        </div>

        <!-- 10. Fetal Age -->
        <div id="baby" class="tool-section">
            <h2>سن جنین (از روی LMP)</h2>
            <div class="row">
                <div class="col"><input type="number" id="preg-day" placeholder="روز"></div>
                <div class="col"><select id="preg-month"><option value="1">فروردین</option><option value="2">اردیبهشت</option><option value="3">خرداد</option><option value="4">تیر</option><option value="5">مرداد</option><option value="6">شهریور</option><option value="7">مهر</option><option value="8">آبان</option><option value="9">آذر</option><option value="10">دی</option><option value="11">بهمن</option><option value="12">اسفند</option></select></div>
                <div class="col"><input type="number" id="preg-year" placeholder="سال"></div>
            </div>
            <button class="action-btn" onclick="calculatePregnancy()">محاسبه</button>
            <div id="baby-result" class="result-box"></div>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jalaali-js/dist/jalaali.min.js"></script>

<script>
    // ---- Core Functions ----
    function openTab(tabName) {
        document.querySelectorAll('.tool-section').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        event.currentTarget.classList.add('active');
        document.querySelectorAll('.result-box').forEach(b => {if(b.id !== 'pass-result') b.style.display = 'none'});
    }
    function showResult(id, title, val, det = "") {
        const b = document.getElementById(id);
        b.innerHTML = `<h3>${title}</h3><div class="result-value">${val}</div><div class="result-detail">${det}</div>`;
        b.style.display = 'block';
    }
    function formatNum(n) { return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); }

    // ---- 1. Gold Calculator ----
    function calcGold() {
        const price = parseFloat(document.getElementById('gold-price').value);
        const weight = parseFloat(document.getElementById('gold-weight').value);
        const wage = parseFloat(document.getElementById('gold-wage').value); // Percent
        
        if(!price || !weight || isNaN(wage)) return alert('لطفا قیمت، وزن و اجرت را وارد کنید');

        // 1. Gold Price + Wage
        const goldPlusWage = price + (price * wage / 100);
        // 2. Add 7% Profit
        const withProfit = goldPlusWage * 1.07;
        // 3. Add 9% Tax (Only on profit + wage, but standard formula often applies to total in simplified market, 
        // but strictly legally tax is on wage+profit. Let's use the common market formula: (Price + Wage) + 7% + 9% on total is usually wrong.
        // Correct Legal: Base Gold + (Wage+Profit * 1.09)
        // Market simplified: (Price * Weight) + ...
        
        // Let's use the standard formula often used by sellers:
        // Total per gram = (Price + Wage_amount + 7%_profit_on_base_wage) + 9%_VAT_on_fees
        // To keep it simple and standard for users:
        // Total = (Price + Wage%) + 7% Profit + 9% VAT
        
        // Let's calculate step by step accurately:
        const rawPrice = price * weight;
        const wageAmount = rawPrice * (wage / 100);
        const profitAmount = (rawPrice + wageAmount) * 0.07;
        const subTotal = rawPrice + wageAmount + profitAmount;
        // Tax is 9% on (Wage + Profit) since Jan 2022 in Iran, NOT on the gold itself.
        const taxAmount = (wageAmount + profitAmount) * 0.09;
        
        const finalPrice = rawPrice + wageAmount + profitAmount + taxAmount;

        const det = `
            قیمت خام طلا: ${formatNum(Math.round(rawPrice))}<br>
            اجرت ساخت: ${formatNum(Math.round(wageAmount))}<br>
            سود فروشنده (7%): ${formatNum(Math.round(profitAmount))}<br>
            مالیات (9% روی سود و اجرت): ${formatNum(Math.round(taxAmount))}
        `;
        showResult('gold-result', 'قیمت نهایی برای پرداخت', formatNum(Math.round(finalPrice)) + ' تومان', det);
    }

    // ---- 2. Discount ----
    function calcDiscount() {
        const p = parseFloat(document.getElementById('disc-price').value);
        const d = parseFloat(document.getElementById('disc-percent').value);
        if(!p || !d) return alert('مقادیر را وارد کنید');
        
        const saved = p * (d/100);
        const final = p - saved;
        showResult('disc-result', 'قیمت با تخفیف', formatNum(Math.round(final)) + ' تومان', `مبلغ سود شما: ${formatNum(Math.round(saved))} تومان`);
    }

    // ---- 3. Password ----
    function genPass() {
        const len = parseInt(document.getElementById('pass-len').value);
        const useSym = document.getElementById('pass-symbol').checked;
        const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        const syms = "!@#$%^&*()_+";
        const allChars = useSym ? chars + syms : chars;
        
        let pass = "";
        for(let i=0; i<len; i++) {
            pass += allChars.charAt(Math.floor(Math.random() * allChars.length));
        }
        document.getElementById('pass-text').innerText = pass;
    }
    function copyPass() {
        const txt = document.getElementById('pass-text').innerText;
        navigator.clipboard.writeText(txt).then(() => alert('کپی شد!'));
    }

    // ---- 4. Calories ----
    function calcCalories() {
        const gen = document.getElementById('cal-gender').value;
        const age = parseFloat(document.getElementById('cal-age').value);
        const h = parseFloat(document.getElementById('cal-height').value);
        const w = parseFloat(document.getElementById('cal-weight').value);
        const act = parseFloat(document.getElementById('cal-activity').value);

        if(!age || !h || !w) return alert('اطلاعات را کامل کنید');

        // Mifflin-St Jeor Equation
        let bmr = (10 * w) + (6.25 * h) - (5 * age);
        bmr += (gen === 'm') ? 5 : -161;

        const tdee = Math.round(bmr * act);
        showResult('cal-result', 'کالری روزانه مورد نیاز', tdee + ' کالری', 'برای ثابت ماندن وزن فعلی');
    }

    // ---- Previous Functions (Simplified for space) ----
    function calculateBMI(){
        const w = parseFloat(document.getElementById('bmi-weight').value), h = parseFloat(document.getElementById('bmi-height').value)/100;
        if(!w || !h) return;
        const bmi = (w/(h*h)).toFixed(1);
        let c = bmi<18.5?"#eab308":bmi<25?"#22c55e":bmi<30?"#f97316":"#ef4444";
        showResult('bmi-result', 'BMI شما', bmi, `<span style="color:${c}">وضعیت شما</span>`);
    }
    
    function calculateAge(){
        const d=parseInt(document.getElementById('age-day').value), m=parseInt(document.getElementById('age-month').value), y=parseInt(document.getElementById('age-year').value);
        if(!d||!y) return;
        const t = jalaali.toJalaali(new Date());
        let ay = t.jy - y, am = t.jm - m, ad = t.jd - d;
        if(ad<0){ am--; ad+=30;} if(am<0){ ay--; am+=12;}
        showResult('age-result', 'سن دقیق', `${ay} سال و ${am} ماه و ${ad} روز`);
    }

    function convertDate(){
        const t=document.getElementById('date-type').value, d=parseInt(document.getElementById('d-day').value), m=parseInt(document.getElementById('d-month').value), y=parseInt(document.getElementById('d-year').value);
        if(!d)return;
        try{
            if(t==='s2g'){ const g=jalaali.toGregorian(y,m,d); showResult('date-result', 'میلادی', `${g.gy}-${g.gm}-${g.gd}`); }
            else{ const j=jalaali.toJalaali(y,m,d); showResult('date-result', 'شمسی', `${j.jy}/${j.jm}/${j.jd}`); }
        }catch(e){alert('تاریخ اشتباه');}
    }

    function calculateLoan(){
        const p=parseFloat(document.getElementById('loan-amount').value), r=parseFloat(document.getElementById('loan-rate').value), n=parseInt(document.getElementById('loan-months').value);
        if(!p)return;
        const i = (r/100)/12; 
        const m = (r===0)? p/n : (p*i*Math.pow(1+i,n))/(Math.pow(1+i,n)-1);
        showResult('loan-result', formatNum(Math.round(m))+' تومان', `بازپرداخت کل: ${formatNum(Math.round(m*n))}`);
    }

    // Unit Init
    const uData = {
        length: {'m':1, 'km':1000, 'cm':0.01, 'mm':0.001, 'in':0.0254, 'ft':0.3048},
        weight: {'kg':1, 'g':0.001, 'lb':0.453, 'oz':0.028},
        temp: {} 
    };
    const uNames = {length:{'m':'متر','km':'کیلومتر','cm':'سانت','mm':'میل','in':'اینچ','ft':'فوت'}, weight:{'kg':'کیلو','g':'گرم','lb':'پوند','oz':'اونس'}, temp:{'c':'سیلسیوس','f':'فارنهایت'}};
    
    function updateUnitOptions(){
        const c = document.getElementById('unit-category').value, f = document.getElementById('unit-from'), t = document.getElementById('unit-to');
        f.innerHTML=''; t.innerHTML='';
        for(let k in uNames[c]){ f.add(new Option(uNames[c][k],k)); t.add(new Option(uNames[c][k],k)); }
        t.selectedIndex=1;
    }
    updateUnitOptions();

    function convertUnit(){
        const c=document.getElementById('unit-category').value, val=parseFloat(document.getElementById('unit-value').value), f=document.getElementById('unit-from').value, t=document.getElementById('unit-to').value;
        if(isNaN(val)) return;
        let res=0;
        if(c==='temp'){ res = (f==='c' && t==='f') ? (val*9/5)+32 : (f==='f' && t==='c') ? (val-32)*5/9 : val; }
        else { res = (val * uData[c][f]) / uData[c][t]; }
        showResult('unit-result', 'نتیجه', res.toFixed(3));
    }

    function calculatePregnancy(){
        const d=parseInt(document.getElementById('preg-day').value), m=parseInt(document.getElementById('preg-month').value), y=parseInt(document.getElementById('preg-year').value);
        if(!d)return;
        const g = jalaali.toGregorian(y,m,d);
        const lmp = new Date(g.gy, g.gm-1, g.gd);
        const due = new Date(lmp); due.setDate(lmp.getDate()+280);
        const jDue = jalaali.toJalaali(due);
        const weeks = Math.floor(Math.abs(new Date()-lmp)/(1000*60*60*24*7));
        showResult('baby-result', 'سن جنین: '+weeks+' هفته', `تاریخ زایمان: ${jDue.jy}/${jDue.jm}/${jDue.jd}`);
    }
</script>
</body>
</html>
